<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quản lý khách hàng</title>
  <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="../css/admin.css">
  <link rel="stylesheet" href="../css/index.css">
  <style>
    body {
      background-color: #f8f9fa;
    }
    .table-responsive {
      max-height: 70vh;
      overflow-y: auto;
    }
    /* Phần chính cuộn ngang */
    .product-scroll {
      display: flex;
      gap: 12px;
      overflow-x: auto;
      overflow-y: hidden;
      flex-wrap: nowrap !important;
      scroll-behavior: smooth;
      padding-bottom: 1rem;
    }
    
  </style>

  <script>
    // ✅ Chặn truy cập nếu chưa đăng nhập admin
    if (localStorage.getItem("AdminLogged") !== "quanly1") {
      window.location.href = "../sites/login_admin.html";
    }
  </script>
</head>

<body>
 <nav class="navbar navbar-expand-lg navbar-dark background-blue fixed-top shadow">
    <div class="container-fluid">

      <!-- Logo -->
      <a href="#" class="navbar-brand d-flex align-items-center">
        <img src="../asset/logo.png" alt="Logo" class="me-2" style="height: 80px;">
      </a>

      <!-- Nút thu gọn -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav"
        aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Menu chính -->
      <div class="collapse navbar-collapse justify-content-end" id="mainNav">
        <ul class="navbar-nav align-items-center text-center mb-2 mb-md-0" id="admin-navbar">
         <li class="nav-item mx-1"><a href="admin_user_manage.html" class="btn btn-outline-dark border-dark">Quản lý người dùng</a></li>
          <li class="nav-item mx-1"><a href="admin_add_items.html" class="btn btn-outline-dark border-dark">Quản lý danh mục sản phẩm</a></li>
          <li class="nav-item mx-1"><a href="admin_add_bill.html" class="btn btn-outline-dark border-dark">Quản lý nhập hàng</a></li>
          <li class="nav-item mx-1"><a href="admin_price_manage.html" class="btn btn-outline-dark border-dark">Quản lý giá bán</a></li>
          <li class="nav-item mx-1"><a href="admin_order_manage.html" class="btn btn-outline-dark border-dark">Quản lý đơn đặt hàng</a></li>
          <li class="nav-item mx-1"><a href="admin_storage_manage.html" class="btn btn-outline-dark border-dark">Quản lý tồn kho</a></li>
        </ul>
        <!-- JS sẽ thêm phần admin vào đây -->
      </div>

      </div>
    </nav>
       <div style="height: 90px"></div>
  <!-- MAIN CONTENT -->
  <div class="container mt-4 mb-5">
    <h2 class="text-center mb-4 fw-bold">Quản lý khách hàng</h2>

    <!-- FORM THÊM KHÁCH HÀNG -->
    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <form id="addUserForm" class="row g-3">
          <div class="col-12 col-md-6 col-lg-2">
            <input type="text" id="username" class="form-control" placeholder="Tài khoản" required />
          </div>
          <div class="col-12 col-md-6 col-lg-2">
            <input type="password" id="password" class="form-control" placeholder="Mật khẩu (tùy chọn)" />
          </div>
          <div class="col-12 col-md-6 col-lg-2">
            <input type="text" id="fullname" class="form-control" placeholder="Họ tên" required />
          </div>
          <div class="col-12 col-md-6 col-lg-3">
            <input type="text" id="address" class="form-control" placeholder="Địa chỉ" required />
          </div>
          <div class="col-12 col-md-6 col-lg-2">
            <input type="tel" id="phone" class="form-control" placeholder="Số điện thoại" required />
          </div>
          <div class="col-12 col-lg-1 d-grid">
            <button type="submit" class="btn btn-primary">Thêm</button>
          </div>
        </form>
      </div>
    </div>

    <!-- DANH SÁCH KHÁCH HÀNG -->
    <div class="card shadow product-scroll" >
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover align-middle text-center" id="userTable">
            <thead class="table-dark">
              <tr>
                <th>Tài khoản</th>
                <th>Họ tên</th>
                <th>Địa chỉ</th>
                <th>SĐT</th>
                <th>Mật khẩu</th>
                <th>Trạng thái</th>
                <th>Hành động</th>
              </tr>
            </thead>
            <tbody>
              <!-- JS render -->
            </tbody>
          </table>
                  <div class="table-responsive">
          <table class="table table-hover align-middle text-center" id="userTable"></table>
          <div id="pagination" class="d-flex justify-content-center mt-3"></div>
        </div>
        </div>
      </div>
    </div>
  </div>

  <script src="../node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
    const nav = document.getElementById("admin-navbar");
    const tenAdmin = localStorage.getItem("AdminLogged") || "Admin";

    const nameItem = document.createElement("li");
    nameItem.className = "nav-item mx-1 fw-bold text-dark";
    nameItem.innerHTML = `
      <div class="d-flex align-items-center">
        <img src="../asset/user_icon.png" alt="User" style="height:40px; width:40px; border-radius:50%; border:2px solid white; margin-right:8px;">
        <span>${tenAdmin}</span>
      </div>
    `;

    const logoutBtn = document.createElement("button");
    logoutBtn.className = "btn background-blue border-dark btn-sm fw-bold ms-2";
    logoutBtn.textContent = "Đăng xuất";
    logoutBtn.onclick = () => {
      alert("Đã đăng xuất!");
      // ❌ Chỉ xóa AdminLogged
      localStorage.removeItem("AdminLogged");
      location.reload();
    };

    const logoutItem = document.createElement("li");
    logoutItem.className = "nav-item mx-1";
    logoutItem.appendChild(logoutBtn);

    nav.appendChild(nameItem);
    nav.appendChild(logoutItem);
  });
// ===============================
// admin_user_manage.js + pagination chuẩn
// ===============================

// --- Dữ liệu mẫu có sẵn ---
const defaultUsers = [
  { username: "user1", password: "123456", fullname: "Nguyễn Văn A", address: "Hà Nội", phone: "0905123456", locked: false },
  { username: "user2", password: "quang123", fullname: "Trần Quốc Quang", address: "TP.HCM", phone: "0912345678", locked: false },
  { username: "user3", password: "bao123", fullname: "Lê Báo", address: "Đà Nẵng", phone: "0933456789", locked: true },
  { username: "user4", password: "thuy123", fullname: "Lê Thùy", address: "Huế", phone: "0945123456", locked: false },
  { username: "user5", password: "hung123", fullname: "Nguyễn Hùng", address: "Hải Phòng", phone: "0956123456", locked: false },
  { username: "user6", password: "khanh123", fullname: "Phạm Khánh", address: "Cần Thơ", phone: "0978123456", locked: false },
  { username: "user7", password: "lan123", fullname: "Trần Lan", address: "Quảng Ninh", phone: "0999123456", locked: true }
];

let users = JSON.parse(localStorage.getItem("users")) || defaultUsers;
const rowsPerPage = 5;
let currentPage = 1;

function saveUsers() {
  localStorage.setItem("users", JSON.stringify(users));
}

// --- Hiển thị danh sách khách hàng ---
function renderUsersTable() {
  const tbody = document.querySelector("#userTable tbody");
  tbody.innerHTML = "";

  users.forEach((user, index) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${user.username}</td>
      <td>${user.fullname}</td>
      <td>${user.address}</td>
      <td>${user.phone}</td>
      <td>${user.password}</td>
      <td>${user.locked ? '<span class="badge bg-danger">Bị khóa</span>' : '<span class="badge bg-success">Hoạt động</span>'}</td>
      <td>
        <div class="d-flex flex-wrap justify-content-center gap-2">
          <button class="btn btn-sm btn-warning" onclick="toggleLock(${index})">${user.locked ? 'Mở khóa' : 'Khóa'}</button>
        </div>
      </td>
    `;
    tbody.appendChild(tr);
  });

  saveUsers();
  setupPagination();
}

// --- Phân trang giống form mẫu ---
function setupPagination() {
  const table = document.getElementById("userTable");
  const rows = Array.from(table.querySelectorAll("tbody tr"));
  const paginationDiv = document.getElementById("pagination");

  function renderTable() {
    rows.forEach(row => row.style.display = "none");
    const totalPages = Math.ceil(rows.length / rowsPerPage);
    currentPage = Math.min(currentPage, totalPages) || 1;

    const start = (currentPage - 1) * rowsPerPage;
    const end = currentPage * rowsPerPage;
    rows.slice(start, end).forEach(row => row.style.display = "");

    renderPagination(totalPages);
  }

  function renderPagination(totalPages) {
    paginationDiv.innerHTML = "";

    const prev = document.createElement("button");
    prev.textContent = "« Trước";
    prev.className = "btn btn-outline-primary btn-sm";
    prev.disabled = currentPage === 1;
    prev.onclick = () => { currentPage--; renderTable(); };

    const next = document.createElement("button");
    next.textContent = "Sau »";
    next.className = "btn btn-outline-primary btn-sm";
    next.disabled = currentPage === totalPages;
    next.onclick = () => { currentPage++; renderTable(); };

    const pageInfo = document.createElement("span");
    pageInfo.textContent = `Trang ${currentPage} / ${totalPages || 1}`;
    pageInfo.className = "mx-2";

    paginationDiv.append(prev, pageInfo, next);
  }

  renderTable();
}

// --- Thêm khách hàng ---
document.getElementById("addUserForm").addEventListener("submit", (e) => {
  e.preventDefault();
  const username = document.getElementById("username").value.trim();
  let password = document.getElementById("password").value.trim();
  const fullname = document.getElementById("fullname").value.trim();
  const address = document.getElementById("address").value.trim();
  const phone = document.getElementById("phone").value.trim();

  if (!username || !fullname || !address || !phone) {
    alert("Vui lòng điền đầy đủ thông tin!");
    return;
  }

  if (users.some(u => u.username === username)) {
    alert("Tên tài khoản đã tồn tại!");
    return;
  }

  if (!password) password = "123456";

  users.push({ username, password, fullname, address, phone, locked: false });
  saveUsers();
  renderUsersTable();
  e.target.reset();
  alert(`✅ Đã thêm khách hàng "${fullname}" (Tài khoản: ${username}, Mật khẩu: ${password})`);
});

// --- Khóa / Mở tài khoản ---
window.toggleLock = function (index) {
  users[index].locked = !users[index].locked;
  saveUsers();
  renderUsersTable();
};

// --- Khi tải xong DOM ---
document.addEventListener("DOMContentLoaded", renderUsersTable);

  </script>
</body>
</html>
